View Raw Code?
#!/usr/bin/env ruby

require 'optparse'

options = {}
optparse = OptionParser.new do |opts|
  opts.banner = "Usage: #{$0} [OPTIONS]"

  opts.on('-w', '--warn PCT', 'Warn if memory usage goes over PCT') do |val|
    options[:warn_pct] = val.to_i
  end

  opts.on('-c', '--crit PCT', 'Critical if memory usage goes over PCT') do |val|
    options[:crit_pct] = val.to_i
  end

  opts.on('-h', '--help', 'Display this screen') do
    puts opts
    exit
  end
end
optparse.parse!

unless options[:crit_pct] &amp;&amp; options[:warn_pct]
  puts optparse.help
  exit
end

# Get the stats from /proc
mem = File.readlines("/proc/meminfo").inject({}) {|m,x| k,v = x.split(/:?\s+/); m[k] = v.to_i; m}
free = mem['MemFree'] + mem['Buffers'] + mem['Cached']
total = mem['MemTotal']
used = total - free
pct_used = used * 100 / total

if pct_used &gt; options[:crit_pct]
  puts "MEMORY CRTIICAL - #{pct_used}% used"
  exit 2
elsif pct_used &gt; options[:warn_pct]
  puts "MEMORY WARNING -  #{pct_used}% used"
  exit 1
else
  puts "MEMORY OK - #{pct_used}% used"
end
