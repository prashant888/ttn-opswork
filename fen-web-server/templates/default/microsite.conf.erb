
<VirtualHost *:80>
  ServerName rangers-apprentice.factmonster.com
  ServerAlias dev.rangers-apprentice.factmonster.com d2.rangers-apprentice.factmonster.com

  SetEnvIfNoCase Host "factmonster\.com$" VARIANT=www

  DocumentRoot /site/html/books/rangers-apprentice/
  Alias /tmpl/ /site/html/template/rangers-apprentice.factmonster.com/
  Alias /css/ /site/html/css/
  Alias /images/ /site/images/
  Alias /js/ /site/html/js/
  Alias /applets/ /site/html/applets/
  Alias / /site/html/books/rangers-apprentice/

  RewriteEngine on
  RewriteOptions inherit

  RewriteCond %{REQUEST_URI} ^/css/([a-zA-Z]+)\.css$
  RewriteCond /site/htmll/css/fm/%1.css -f
  RewriteRule ^/css/([a-zA-Z]+)\.css$ /site/html/css/fm/$1.css [L]
  RewriteRule ^/favicon.ico /site/images/icons/fm_favicon.ico [L]

  RewriteRule /robots.txt /site/html/applets/robots.php [L]

  RewriteRule ^/quizzes/([^/]+)/([0-9]+)\.html /quizzes/$1.php [L]
  RewriteRule ^(/polls/)$ $1/index.html [L]
  RewriteRule ^/polls/([^/]+).html /site/html/applets/launchpoll.php3?poll=$1 [L]
  RewriteRule ^/pollresults$ /site/html/applets/pollresults.php?poll=$1 [L]

  RewriteRule ^(/dyn/.*)$ /site/images/$1 [L]
  RewriteRule ^/img/(.*)$ /site/images/fe/$1 [L]
  AliasMatch ^/images/([^/.])([^/.])([^/.])([^/.])([^/.])([^/]+)$ /site/images/$2/$3/$4/$5/$6/$2$3$4$5$6$7
  AliasMatch ^/images/([^/.])([^/.])([^/.])([^/.])(\.[^/]+)$ /site/images/$2/$3/$4/$5/$2$3$4$5$6
  AliasMatch ^/images/([^/.])([^/.])([^/.])(\.[^/]+)$ /site/images/$2/$3/$4/$2$3$4$5
  AliasMatch ^/images/([^/.])([^/.])(\.[^/]+)$ /site/images/$2/$3/$2$3$4
  AliasMatch ^/images/([^/]+/.*)$ /site/images/$1

  RewriteCond %{REQUEST_URI} !^/(polls|quizzes)/
  RewriteCond %{REQUEST_URI} ^/[^/]+/
  RewriteRule ^/([^/]+)/(.*) http://www.factmonster.com/$1/$2 [R=301,L]

  RewriteCond %{REQUEST_URI} ^/([^/]+)\.html$
  RewriteCond /site/html/books/rangers-apprentice/%{REQUEST_URI} !-f
  RewriteRule ^/(.*) http://www.factmonster.com/$1 [R=301,L]

  AddType image/vnd.microsoft.icon .ico

# include <fmredirects.conf>
# include <kids.conf>
  RewriteRule ^/altsite/(.*) http://www.infoplease.com/$1 [R=301,L]
  RewriteCond %{REQUEST_URI} ^/css/([a-zA-Z]+)\.css$
  RewriteCond /site/html/css/fm/%1.css -f
  RewriteRule ^/css/([a-zA-Z]+)\.css$ /css/fm/%1.css [PT]
</VirtualHost>
